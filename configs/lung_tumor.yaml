# Lung Tumor Segmentation Configuration
# ======================================

# Model Configuration
model:
  type: attention_unet   # Options: unet, attention_unet
  n_channels: 1          # Grayscale CT images
  n_classes: 2           # Background + Tumor
  bilinear: true         # Use bilinear upsampling (vs transposed conv)
  base_features: 64      # Base number of features
  deep_supervision: false # Disabled (low-res heads hurt small tumor detection)

# Data Configuration
data:
  root: ./dataset
  img_size: 512          # Higher resolution for small tumor detection
  val_ratio: 0.2         # 20% for validation
  batch_size: 4          # Effective 32 via gradient accumulation
  num_workers: 4

# Training Configuration
train:
  epochs: 150
  lr: 0.00005            # 5e-5, target lr (after warmup if using warmup_cosine)
  weight_decay: 0.0001
  grad_clip: 1.0         # Gradient clipping (0 to disable)
  accumulation_steps: 8  # Gradient accumulation (effective batch = 4 x 8 = 32)

# Learning Rate Scheduler
scheduler:
  type: warmup_cosine      # Options: cosine_annealing, warmup_cosine, reduce_on_plateau
  warmup_epochs: 10        # Linear warmup from ~0 to lr (warmup_cosine only)
  min_lr: 0.000001

# EMA (Exponential Moving Average)
ema:
  enabled: false           # Disabled (causes tumor dice collapse for small-target tasks)

# Early Stopping
early_stopping:
  enabled: true
  patience: 30
  monitor: class_dice.tumor
  mode: max

# Loss Function
loss:
  type: dice_bce              # BalancedCE + Dice (most stable for small targets)
  balanced_class_weight: 0.5  # Weight for tumor class (0.5 = equal attention)
  ce_weight: 1.0              # Weight for balanced CE component
  dice_weight: 1.0            # Weight for Dice component

# Data Augmentation
augmentation:
  enabled: true
  horizontal_flip: 0.5   # Probability
  rotation_limit: 15     # Max rotation angle
  elastic: 0.3           # Elastic deformation probability
  brightness_contrast: 0.3

# Output Configuration
output:
  save_dir: ./runs
  experiment_name: lung_tumor_ds512
  save_last: true        # Save last checkpoint
  save_best: true        # Save best checkpoint

# Reproducibility
seed: 42

# Device
device: ""               # Empty for auto-detect (cuda > mps > cpu)
