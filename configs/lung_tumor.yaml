# Lung Tumor Segmentation Configuration
# ======================================

# Model Configuration
model:
  type: attention_unet   # Options: unet, attention_unet
  n_channels: 1          # Grayscale CT images
  n_classes: 2           # Background + Tumor
  bilinear: true         # Use bilinear upsampling (vs transposed conv)
  base_features: 64      # Base number of features

# Data Configuration
data:
  root: ./dataset
  img_size: 256
  val_ratio: 0.2         # 20% for validation
  batch_size: 8
  num_workers: 4

# Training Configuration
train:
  epochs: 150
  lr: 0.00005            # Very low constant learning rate
  weight_decay: 0.0001   # L2 regularization
  grad_clip: 1.0         # Gradient clipping (0 to disable)

# Learning Rate Scheduler
scheduler:
  type: reduce_on_plateau  # Use plateau-based reduction instead of warmup
  patience: 15             # Wait longer before reducing
  factor: 0.5              # LR reduction factor
  min_lr: 0.000001

# EMA (Exponential Moving Average) - Stabilizes training
ema:
  enabled: true            # Use EMA for validation and saving
  decay: 0.99              # Lower decay for faster adaptation (was 0.999)
  warmup_epochs: 10        # Use training model for first N epochs

# Early Stopping
early_stopping:
  enabled: true          # Re-enable early stopping
  patience: 30           # Epochs to wait before stopping
  monitor: class_dice.tumor  # Monitor TUMOR dice, not mean dice!
  mode: max              # 'max' for metrics, 'min' for loss

# Loss Function
loss:
  type: balanced_focal_tversky  # Balanced CE + Focal Tversky
  # Balanced CE: each image weight=1, tumor pixels share 0.5, background shares 0.5
  balanced_class_weight: 0.5    # Weight for tumor class (0.5 = equal attention)
  ce_weight: 1.0                # Weight for balanced CE component
  dice_weight: 1.0              # Weight for Focal Tversky component
  # Focal Tversky parameters
  tversky_alpha: 0.7            # Weight for false negatives
  tversky_beta: 0.3             # Weight for false positives
  focal_gamma: 0.75             # Focus on hard examples

# Data Augmentation
augmentation:
  enabled: true
  horizontal_flip: 0.5   # Probability
  rotation_limit: 15     # Max rotation angle
  elastic: 0.3           # Elastic deformation probability
  brightness_contrast: 0.3

# Output Configuration
output:
  save_dir: ./runs
  experiment_name: liver_tumor_balanced
  save_last: true        # Save last checkpoint
  save_best: true        # Save best checkpoint

# Reproducibility
seed: 42

# Device
device: ""               # Empty for auto-detect (cuda > mps > cpu)
